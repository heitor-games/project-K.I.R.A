<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project K.I.R.A</title>
    <link rel="stylesheet" href="stylesheets/style.css"/>
</head>
<body>

    <div class="store-box" style="border-color: #f1c50f; margin-top: 20px;">
        <h3><a href="./loja.html">Loja K.I.R.A</a></h3>
        <p>Gaste seus KiraCoins em itens F√≠sicos</p>

        <div id="shop-items" style="display: grid; gap: 10px">Itens Dispon√≠veis:</div>
    </div>

    <div id="inventory-section" style="margin-top: 15px; font-size: 0.8rem; color: #aaa;">
        <strong>Seus Pedidos: </strong>
        <div id="inventory-list">Nenhum Pedido ainda.</div>
    </div>
    <div id="auth-container" class="card">
        <h1>Project K.I.R.A</h1>
        
        <h2 id="auth-tiltle">Entrar</h2>

        <!-- Authentication Inputs -->
        <input type="email" id="auth-email" placeholder="Seu E-mail" style="width: 90%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: none;"/>
        <input type="password" id="auth-password" placeholder="Sua Senha" style="width: 90%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: none;"/>

        <!-- Authentication Buttons -->
        <button id="btn-login" onclick="handleAuth('login')">LogIn</button>

        <button id="btn-register" onclick="handleAuth('signup')">Registrar</button>

        <p id="auth-msg" style="font-size: 0.8rem; margin-top: 10px;"></p>
    </div>
    <div id="game-container" class="card" style="display: none;">
        <h1>Project K.I.R.A</h1>

        <div class="stats">ü™ô <span id="balance">0</span> K.I.R.A Coins</div>

        <div class="mission-box">
            <button id="btn-mission" onclick="startMission()">Gerar Miss√£o</button>

            <div class="mission-box">
                <h3>Miss√£o</h3>
                <p>Descric√£o</p>
            </div>
            <p id="status-msg">Pronto para Come√ßar?</p>
        </div>

        <div class="log" id="log">Logs de Miss√£o: Ol√° Viajante!</div>

    </div>

    <script src="src/core.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        const supabaseUrl = 'https://ekwclfkdjeubxyxbqmim.supabase.co';
        const supabaseKey = 'sb_publishable_CYrNJegggS6xqtNimkYEng_pBu4kOGY';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        async function handleAuth(type) {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const msg = document.getElementById('auth-msg');

            msg.innerText = 'Processando...';

            let result;
            if (type === 'signup') {
                result = await supabaseClient.auth.signUp({ email, password });
            } else {
                result = await supabaseClient.auth.signInWithPassword({ email, password });
            }

            if (result.error) {
                msg.innerText = `Erro: ${result.error.message}`;
                msg.style.color = 'red';
            } else {
                msg.innerText = 'Sucesso! Logando...';
                msg.style.color = 'green';

                setTimeout(() => iniciarJogo(result.data.user), 360);
            }
        }

        async function iniciarJogo(user) {
            // esconde o Login/Registro e mostra o jogo
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            // Carrega os coins do banco de dados (tabela "users", coluna "kiracoins")
            const { data, error } = await supabaseClient.from('users').select('kiracoins').eq('id', user.id).single();
            if (data) {
                kiracoins = data.kiracoins;
                updateDisplay();
            }
        }
    </script>

</body>
</html>